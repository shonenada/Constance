键盘控制
=================

PS/2 控制器（键盘控制器）在早期是一个 8042 芯片，而现在的键盘控制则是 Advanced Integrated Peripheral 的一部分。

原始的 IBM-PC 键盘使用使用旧试的 XT 接口（scan code set 1），而新的 AT 键盘则使用新接口（scan code set 2）。这个改变将引发兼容问题。但这个问题可以通过 translation 来解决。


PS/2 Controller IO Ports
---------------------------------

PS/2 控制器使用两个 IO 口 (0x60, 0x64)。

+------------+-----------+--------------+
| IO Port    | 接入类型  | 目标         |
+------------+-----------+--------------+
| 0x60       | 读写      | 数据口       |
+------------+-----------+--------------+
| 0x64       | 读取      | 状态寄存器   |
+------------+-----------+--------------+
| 0x64       | 写入      | 命令寄存器   |
+------------+-----------+--------------+

当一个键被按下的时候，键盘发送的扫描码称为接通扫描码（Mask Code， 接通码）。
当一个被按下的键被释放的时候，发送的扫描码被称为扫断开扫描码（Break Code），断开码。

键盘控制器专用对接收到的扫描码进行解码，并把解码后的数据发送到 OS 的键盘数据队列中。

计算机发展至今有三套 Scan Code Set

1、原始 XT 键盘扫描码集。
2、现代键盘默认使用的扫描码，通常称为 AT 键盘扫描码集。
3、PS/2 键盘扫描码集。原 IBM 推出 PS/2 微机时使用的扫描码集，已很少使用。

通常键盘控制器为了能够兼容，会将第二种扫描码集转换成第一套扫描码集。

键盘控制器通常使用 Intel 8042 单片微机处理芯片或其兼容电路。

键盘控制器接收键盘发送11位串行格式数据。
第 1 位 是 起始位，
第 2 - 9 位是 8 位键盘扫描码，
第 10 位是奇校验校验位，
第 11 位是停止位。

键盘控制器接收到停止位之后就进行转换，之后通过中断控制器 IRQ1 引脚向 CPU 发送中断请求。
中断终端处理程序读取 XT 键盘扫描码。

断开码 = 接通码 + 0x80，即最高有效位置位。

对于有些扩展键盘，例如右边的 ctrl 和 alt，则接通码可能扩展到 2 ~ 4 字节，并且第一个字节是 0xE0。
